---
title: "SDG Combining report"
author: "Michael Rahija"
date: "July 12, 2019"
output:
  html_document: default
  pdf_document: default
editor_options:
  chunk_output_type: console
---

# Report to combine datasets

## Load package 
```{r }
#set up
knitr::opts_chunk$set(echo = T, warning=F, message = F)
library(FAOSDGdata)
library(dplyr)

```

### Download single dataset through API

```{r }
sdg <- getData("2.1.1", 
               source = "web")

head(sdg)
```

### Download multiples SDG datasets

```{r }
allSdgs <- getDatasets(all = T)

head(allSdgs)

```


### Clean single dataset to have easier column names, consistent classes, and only keep columns needed for analysis.
```{r }
cleandf <- getData("2.1.2", 
                  source = "web") %>%
           cleanData()

head(cleandf)
```

### Get all dataset, clean them, merge into single datafarme
```{r }
cleanall <- lapply(allSdgs, cleanData)

sdgsdf <- do.call("rbind", cleanall)

nrow(sdgsdf)
head(sdgsdf)

```


### Tabulate to check for consistent naming focusing on areacodes and names
```{r }
areas <- sdgsdf %>% 
              group_by(areacode, areaname) %>% 
              summarize(n = n()) %>% 
              group_by(areacode) %>%
              mutate(AreaCodeRepete = n()) %>%
              arrange(areacode) %>%
              as.data.frame()


areas$areaname <- substr(areas$areaname, start = 1, stop = 50)

arrange(areas, areaname)
```






### Tabulate to check for units
```{r }

sdgsdf %>% 
      group_by(unit) %>% 
      summarize(n = n())

```

# Create country data file
```{r }

#This dataset, already omiported and cleaned
sdgsdf <- read.csv("~/Desktop/temp_raw_dataframe.csv", stringsAsFactors = F)
cleanSdgs <- sdgsdf
cr <- cleanSdgs

#remove observations without codes
cr <- filter(cr, !is.na(areacode))

cr_m <-  left_join(cr,
                   m49, #internal dataframe
                   by = c("areacode" = "Code"))



#add 0s to codes for sdg dataset
cr$areacode[str_length(cr$areacode) == 1] <- paste0("00", ... = cr$areacode[str_length(cr$areacode) == 1])
cr$areacode[str_length(cr$areacode) == 2] <- paste0("0", cr$areacode[str_length(cr$areacode) == 2])

cr <- filter(cleanSdgs, areatype == "2.4-Regional (M49)" |
                        areatype == "" some say regional M49, others say Regional SDG
                        areatype == "3.0-Country")

#add 0s to codes for sdg dataset
cr$areacode[str_length(cr$areacode) == 1] <- paste0("00", ... = cr$areacode[str_length(cr$areacode) == 1])
cr$areacode[str_length(cr$areacode) == 2] <- paste0("0", cr$areacode[str_length(cr$areacode) == 2])
  
cr_m <-  left_join(cr,
                   m49, #internal dataframe
                   by = c("areacode" = "Code"))

#drop whatever doesnt' match in m49
cr_m <- filter(cr_m, !is.na(Name))


#check geo names
test <- cr_m %>% group_by(Name, areacode) %>% summarize(n = n())

```